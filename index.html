<!DOCTYPE html>
<html>
<head>
  <title>Obtener Datos y Enviar a Telegram</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ua-parser-js/0.7.28/ua-parser.min.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  
</head>
<body>
  <h1>Obtener Datos y Enviar a Telegram</h1>

  

  <script>
    // Objeto para almacenar los datos del usuario
    var userData = {};

    // Función para enviar datos a Telegram
    function sendToTelegram(message) {
      // Verificar si el mensaje está vacío
      if (!message) {
        console.error('Error al enviar el mensaje a Telegram: El texto del mensaje está vacío');
        return;
      }

      const botToken = '1597773806:AAFh0xrEMv7pmSuDF84XGc5MA5C7SMdiKZw'; // Agrega aquí el token de tu bot de Telegram
      const chatId = '1116794830'; // Agrega aquí el ID de tu chat de Telegram

      const telegramUrl = `https://api.telegram.org/bot${botToken}/sendMessage`;
      const data = {
        chat_id: chatId,
        text: message
      };

      axios.post(telegramUrl, data)
        .then(response => {
          console.log('Mensaje enviado a Telegram:', response.data);
        })
        .catch(error => {
          console.error('Error al enviar el mensaje a Telegram:', error);
        });
    }

    // Obtener datos de dispositivo, IP y mostrar mensaje en Telegram
    function getData() {
      // Obtener información del dispositivo, navegador y sistema operativo
      var userAgent = navigator.userAgent;
      var parser = new UAParser();
      var result = parser.setUA(userAgent).getResult();

      userData.device = result.device.model || '';
      userData.brand = result.device.vendor || '';
      userData.browser = result.browser.name || '';
      userData.os = result.os.name || '';

      // Obtener el identificador de dispositivo
      var deviceIdentifier = localStorage.getItem('deviceIdentifier');
      var isFirstTime = localStorage.getItem('isFirstTime') === null;

      if (isFirstTime) {
        deviceIdentifier = generateDeviceIdentifier(); // Generar un identificador único
        localStorage.setItem('deviceIdentifier', deviceIdentifier);
        localStorage.setItem('isFirstTime', 'false');
        sendToTelegram(`Hola, el usuario ingresó a las ${getCurrentTime()}.\n\nInformación del dispositivo:\nDispositivo: ${userData.device}\nMarca: ${userData.brand}\nEste usuario es: Primer inicio\nEl usuario ha cambiado de identidad: No\nEl usuario ha cambiado de identidad: 0 veces`);
      } else if (deviceIdentifier === localStorage.getItem('deviceIdentifier')) {
        sendToTelegram(`Hola, el usuario ingresó a las ${getCurrentTime()}.\n\nInformación del dispositivo:\nDispositivo: ${userData.device}\nMarca: ${userData.brand}\nEste usuario es: No es el primer inicio\nEl usuario ha cambiado de identidad: Sí\nEl usuario ha cambiado de identidad: ${getIdentityChanges()} veces`);
      }

      // Actualizar la cantidad de veces que el usuario ha cambiado de identidad
      localStorage.setItem('identityChanges', JSON.stringify(userData));

      // Otras acciones que deseas realizar
      // ...

    }

        // Obtener la hora actual en formato de 12 horas
    function getCurrentTime() {
      var now = new Date();
      var hours = now.getHours();
      var minutes = now.getMinutes();
      var ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12;
      hours = hours ? hours : 12; // Si hours es 0, se reemplaza por 12
      minutes = minutes < 10 ? '0' + minutes : minutes;
      var time = hours + ':' + minutes + ' ' + ampm;
      return time;
    }

    // Obtener la cantidad de veces que el usuario ha cambiado de identidad
    function getIdentityChanges() {
      var identityChanges = localStorage.getItem('identityChanges');
      if (identityChanges) {
        identityChanges = JSON.parse(identityChanges);
        return identityChanges.changes || 0;
      }
      return 0;
    }

    // Generar un identificador único para el dispositivo
    function generateDeviceIdentifier() {
      var d = new Date().getTime();
      if (window.performance && typeof window.performance.now === 'function') {
        d += performance.now();
      }
      var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = (d + Math.random() * 16) % 16 | 0;
        d = Math.floor(d / 16);
        return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
      });
      return uuid;
    }

    // Llamar a la función para obtener los datos
    getData();
  </script>
</body>
</html>
